"""
–¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è –Ω–∞ 2 –Ω–µ–¥–µ–ª–∏
"""
from datetime import datetime, timedelta

# ========== –°–ü–ò–°–û–ö –ó–ê–î–ê–ù–ò–ô ==========

TASKS = {
    'task_1': {
        'id': 'task_1',
        'title': 'üì∏ –ü–û–†–¢–†–ï–¢ –î–†–£–ì–ê',
        'description': '–°–Ω–∏–º–∏ –∫—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω —Å–≤–æ–µ–≥–æ –¥—Ä—É–≥–∞ –∏–ª–∏ –æ–¥–Ω–æ–≥—Ä—É–ø–ø–Ω–∏–∫–∞',
        'requirements': [
            '‚úÖ –ö—Ä—É–ø–Ω—ã–π –ø–ª–∞–Ω (–≥–æ–ª–æ–≤–∞ –∏ –ø–ª–µ—á–∏)',
            '‚úÖ –•–æ—Ä–æ—à–∏–π —Å–≤–µ—Ç (–æ–∫–Ω–æ –∏–ª–∏ –ª–∞–º–ø–∞)',
            '‚úÖ –í–∏–¥–Ω–∞ —ç–º–æ—Ü–∏—è (—É–ª—ã–±–∫–∞, –≤–∑–≥–ª—è–¥)',
            '‚úÖ –†–∞–∑–º—ã—Ç—ã–π —Ñ–æ–Ω (–µ—Å–ª–∏ –ø–æ–ª—É—á–∏—Ç—Å—è)'
        ],
        'tips': [
            'üí° –ü–æ–ø—Ä–æ—Å–∏ –¥—Ä—É–≥–∞ –≤—Å—Ç–∞—Ç—å —É –æ–∫–Ω–∞ - –±—É–¥–µ—Ç –º—è–≥–∫–∏–π —Å–≤–µ—Ç',
            'üí° –§–æ–∫—É—Å –Ω–∞ –≥–ª–∞–∑–∞ - –æ–Ω–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —á—ë—Ç–∫–∏–º–∏',
            'üí° –ü–æ–ø—Ä–æ—Å–∏ –ø–æ–∫–∞–∑–∞—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–µ —ç–º–æ—Ü–∏–∏, –Ω–µ –Ω–∞—Ç—è–Ω—É—Ç—É—é —É–ª—ã–±–∫—É',
            'üí° –°–Ω–∏–º–∞–π –Ω–∞ —É—Ä–æ–≤–Ω–µ –≥–ª–∞–∑ –º–æ–¥–µ–ª–∏'
        ],
        'examples': 'üì± –ü—Ä–∏–º–µ—Ä: —á–µ–ª–æ–≤–µ–∫ —É –æ–∫–Ω–∞, —Å–º–æ—Ç—Ä–∏—Ç –≤ –∫–∞–º–µ—Ä—É, —Ñ–æ–Ω —Ä–∞–∑–º—ã—Ç',
        'start_date': '2024-11-04',
        'end_date': '2024-11-18',
        'xp_reward': 200,
        'active': True
    },
    
    'task_2': {
        'id': 'task_2',
        'title': 'üåÜ –ó–û–õ–û–¢–û–ô –ß–ê–°',
        'description': '–°–Ω–∏–º–∏ –ø–µ–π–∑–∞–∂ –≤–æ –≤—Ä–µ–º—è –∑–æ–ª–æ—Ç–æ–≥–æ —á–∞—Å–∞ (–∑–∞–∫–∞—Ç –∏–ª–∏ —Ä–∞—Å—Å–≤–µ—Ç)',
        'requirements': [
            '‚úÖ –°–Ω—è—Ç–æ –Ω–∞ –∑–∞–∫–∞—Ç–µ –∏–ª–∏ —Ä–∞—Å—Å–≤–µ—Ç–µ',
            '‚úÖ –í–∏–¥–µ–Ω –∫—Ä–∞—Å–∏–≤—ã–π —Å–≤–µ—Ç',
            '‚úÖ –ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è',
            '‚úÖ –ì–æ—Ä–∏–∑–æ–Ω—Ç —Ä–æ–≤–Ω—ã–π'
        ],
        'tips': [
            'üí° –ó–æ–ª–æ—Ç–æ–π —á–∞—Å: —á–∞—Å –ø–æ—Å–ª–µ —Ä–∞—Å—Å–≤–µ—Ç–∞ –∏–ª–∏ —á–∞—Å –¥–æ –∑–∞–∫–∞—Ç–∞',
            'üí° –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∞–≤–∏–ª–æ —Ç—Ä–µ—Ç–µ–π',
            'üí° –ù–∞–π–¥–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π –æ–±—ä–µ–∫—Ç (–¥–µ—Ä–µ–≤–æ, –∑–¥–∞–Ω–∏–µ)',
            'üí° –ù–µ —Å—Ç–∞–≤—å –≥–æ—Ä–∏–∑–æ–Ω—Ç –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–∞–¥—Ä–∞'
        ],
        'examples': 'üì± –ü—Ä–∏–º–µ—Ä: –∑–∞–∫–∞—Ç, —Å–∏–ª—É—ç—Ç –¥–µ—Ä–µ–≤–∞, —Ç–µ–ø–ª—ã–µ —Ü–≤–µ—Ç–∞',
        'start_date': '2024-11-18',
        'end_date': '2024-12-02',
        'xp_reward': 200,
        'active': False
    },
    
    'task_3': {
        'id': 'task_3',
        'title': 'üé¨ –†–ï–ü–û–†–¢–ê–ñ –ò–ó –ñ–ò–ó–ù–ò',
        'description': '–°–Ω–∏–º–∏ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤–∏–¥–µ–æ (30 —Å–µ–∫) –ø—Ä–æ —Å–≤–æ–π –¥–µ–Ω—å',
        'requirements': [
            '‚úÖ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: 20-40 —Å–µ–∫—É–Ω–¥',
            '‚úÖ –ú–∏–Ω–∏–º—É–º 3 —Ä–∞–∑–Ω—ã—Ö –∫–∞–¥—Ä–∞',
            '‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ (–±–µ–∑ —Ç—Ä—è—Å–∫–∏)',
            '‚úÖ –†–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏—é'
        ],
        'tips': [
            'üí° –ü–ª–∞–Ω: —É—Ç—Ä–æ ‚Üí –¥–æ—Ä–æ–≥–∞ ‚Üí –∑–∞–Ω—è—Ç–∏–µ ‚Üí –¥–æ–º',
            'üí° –î–µ—Ä–∂–∏ —Ç–µ–ª–µ—Ñ–æ–Ω –¥–≤—É–º—è —Ä—É–∫–∞–º–∏',
            'üí° –ü–ª–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è –∫–∞–º–µ—Ä—ã',
            'üí° –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º—É–∑—ã–∫—É –∏–ª–∏ –≥–æ–ª–æ—Å –∑–∞ –∫–∞–¥—Ä–æ–º'
        ],
        'examples': 'üì± –ü—Ä–∏–º–µ—Ä: –∫–æ—Ä–æ—Ç–∫–∏–µ –∫–∞–¥—Ä—ã –∏–∑ —Ç–≤–æ–µ–≥–æ –¥–Ω—è',
        'start_date': '2024-12-02',
        'end_date': '2024-12-16',
        'xp_reward': 300,
        'active': False
    },
    
    'task_4': {
        'id': 'task_4',
        'title': '‚ùÑÔ∏è –ó–ò–ú–ù–Ø–Ø –°–ö–ê–ó–ö–ê',
        'description': '–°–Ω–∏–º–∏ —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–≥–æ–¥–Ω–µ–µ: —É–∫—Ä–∞—à–µ–Ω–∏—è, —Å–Ω–µ–≥, –∞—Ç–º–æ—Å—Ñ–µ—Ä—É',
        'requirements': [
            '‚úÖ –ù–æ–≤–æ–≥–æ–¥–Ω—è—è –∏–ª–∏ –∑–∏–º–Ω—è—è —Ç–µ–º–∞',
            '‚úÖ –ö—Ä–∞—Å–∏–≤–∞—è –∫–æ–º–ø–æ–∑–∏—Ü–∏—è',
            '‚úÖ –•–æ—Ä–æ—à–µ–µ –æ—Å–≤–µ—â–µ–Ω–∏–µ',
            '‚úÖ –ü–µ—Ä–µ–¥–∞—ë—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ'
        ],
        'tips': [
            'üí° –°–Ω–∏–º–∞–π –æ–≥–æ–Ω—å–∫–∏ –≥–∏—Ä–ª—è–Ω–¥ —Ä–∞–∑–º—ã—Ç–æ (–±–æ–∫–µ)',
            'üí° –ú–∞–∫—Ä–æ —Å–Ω–µ–∂–∏–Ω–æ–∫ –Ω–∞ —Å—Ç–µ–∫–ª–µ',
            'üí° –£–∫—Ä–∞—à–µ–Ω–Ω—ã–µ —É–ª–∏—Ü—ã –≤–µ—á–µ—Ä–æ–º',
            'üí° –ú–æ–∂–Ω–æ —Å–Ω—è—Ç—å –≤ –ø–æ–º–µ—â–µ–Ω–∏–∏ –∏–ª–∏ –Ω–∞ —É–ª–∏—Ü–µ'
        ],
        'examples': 'üì± –ü—Ä–∏–º–µ—Ä: —ë–ª–æ—á–Ω—ã–µ –∏–≥—Ä—É—à–∫–∏, –≥–∏—Ä–ª—è–Ω–¥—ã, —Å–Ω–µ–≥',
        'start_date': '2024-12-16',
        'end_date': '2024-12-30',
        'xp_reward': 200,
        'active': False
    }
}

# ========== –§–£–ù–ö–¶–ò–ò ==========

def get_active_task():
    """–ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ –∞–∫—Ç–∏–≤–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ"""
    now = datetime.now()
    
    for task in TASKS.values():
        start = datetime.strptime(task['start_date'], '%Y-%m-%d')
        end = datetime.strptime(task['end_date'], '%Y-%m-%d')
        
        if start <= now <= end:
            return task
    
    return None

def get_task_by_id(task_id):
    """–ü–æ–ª—É—á–∏—Ç—å –∑–∞–¥–∞–Ω–∏–µ –ø–æ ID"""
    return TASKS.get(task_id)

def get_all_tasks():
    """–ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è"""
    return list(TASKS.values())

def get_days_left(task):
    """–°–∫–æ–ª—å–∫–æ –¥–Ω–µ–π –¥–æ –∫–æ–Ω—Ü–∞ –∑–∞–¥–∞–Ω–∏—è"""
    if not task:
        return 0
    
    end_date = datetime.strptime(task['end_date'], '%Y-%m-%d')
    now = datetime.now()
    delta = end_date - now
    
    return max(0, delta.days)

def format_task_message(task):
    """–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    if not task:
        return "–°–µ–π—á–∞—Å –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π ü§∑‚Äç‚ôÇÔ∏è"
    
    days_left = get_days_left(task)
    
    text = f"*{task['title']}*\n\n"
    text += f"üìù *–ó–∞–¥–∞–Ω–∏–µ:*\n{task['description']}\n\n"
    
    text += "üìã *–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:*\n"
    for req in task['requirements']:
        text += f"{req}\n"
    
    text += "\nüí° *–ü–æ–¥—Å–∫–∞–∑–∫–∏:*\n"
    for tip in task['tips']:
        text += f"{tip}\n"
    
    text += f"\n{task['examples']}\n\n"
    text += f"üéÅ *–ù–∞–≥—Ä–∞–¥–∞:* –¥–æ {task['xp_reward']} XP\n"
    text += f"üìÖ *–î–æ –∫–æ–Ω—Ü–∞:* {days_left} –¥–Ω–µ–π\n\n"
    text += "–ì–æ—Ç–æ–≤? –û—Ç–ø—Ä–∞–≤—å —Å–≤–æ—ë —Ñ–æ—Ç–æ –∏–ª–∏ –≤–∏–¥–µ–æ! üì∏"
    
    return text

def format_task_short(task):
    """–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è"""
    if not task:
        return "–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è"
    
    days_left = get_days_left(task)
    return f"{task['title']}\nüìÖ –î–æ –∫–æ–Ω—Ü–∞: {days_left} –¥–Ω–µ–π"
